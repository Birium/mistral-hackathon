services:
  core:
    build: ./core
    profiles: [all, core]
    ports: ["8000:8000"]
    volumes:
      - ./vault:/vault
      - ./core:/app
    environment:
      - VAULT_PATH=/vault
      - QDRANT_URL=http://vectordb:6333
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
    depends_on: [vectordb]

  vectordb:
    image: qdrant/qdrant
    profiles: [all, core]
    ports: ["6333:6333"]
    volumes:
      - qdrant_data:/qdrant/storage

  web:
    build: ./web
    profiles: [all, web]
    ports: ["5173:5173"]
    environment:
      - VITE_API_URL=http://localhost:8000

volumes:
  qdrant_data: