# Todo

## Prompting style overhaul — move from human-oriented to AI-oriented

- [ ] Rewrite all prompt files to use tight XML structure instead of verbose markdown prose

    The current prompts (env_prompt.py, agent_loop_prompt.py, context_prompt.py, search_agent_prompt.py, update_agent_prompt.py) are written like documentation for humans — long paragraphs, bold labels, markdown formatting everywhere. LLMs parse structured XML far more efficiently than prose-heavy markdown. The rewrite should strip unnecessary verbosity, remove markdown formatting inside prompts (bold, inline code used for emphasis rather than reference), and use XML tags to delineate sections cleanly. The concision principle applies to everything the agent produces internally: "Be extremely concise. Sacrifice grammar for the sake of concision." But user-facing output (the final answer, confirmation messages) should remain well-written and readable. This distinction — terse internal reasoning, polished external output — needs to be explicit in the prompts. All prompt files live in `core/agent/prompts/`.

## Read tool — remove head/tail, leverage paths and wildcards

- [x] Strip head and tail parameters from the read tool signature and implementation

    The read tool currently has `head` and `tail` optional parameters for token-budgeted partial reads. These are being removed. The tool should accept a list of paths, support wildcards/globs in those paths, and return full file contents. The function signature in `core/agent/tools/read_tool.py` wraps `functions/read.py` — both need updating. The read prompt (READ_TOOL_PROMPT in the same file) currently has extensive guidance on when to use head vs tail, token budget tiers (under 5k, 5k-20k, etc.) — all of that goes away.

- [x] Rewrite READ_TOOL_PROMPT with wildcard patterns and concrete examples

    The new read prompt should focus heavily on the power of path patterns. Multiple paths in one call, glob wildcards to scan across projects, reading entire directories. Concrete examples are critical — show patterns like reading all state.md across projects, reading a full project directory, scanning all changelogs. The agent should understand that paths are its primary lever for efficient exploration. Token guidance should be simplified drastically: anything under 150k tokens is fine to load, only above that does it need to be careful. No micro-optimization, no tier-based rules. Load what you need, move fast.

- [x] Consider a separate "surgical read" tool for future partial-file reads

    The head/tail capability might come back later as a distinct tool (a targeted/surgical read for very large files). Not for now — just noting it as a future possibility so the architecture stays clean. No action needed in this pass.

## Tree tool — remove depth parameter

- [x] Remove depth parameter from tree tool signature and implementation

    The tree tool in `core/agent/tools/tree_tool.py` wraps `functions/tree.py`. The depth parameter should be removed entirely. The vault structure is flat and repetitive enough that full tree output is always acceptable — even a bucket with 150 files is fine to display. The prompt (TREE_TOOL_PROMPT) currently emphasizes using depth for exploration and distinguishes between the initial vault-structure and the dynamic tree tool. Since tree.md no longer exists as a pre-loaded file, the tree tool becomes the primary way to see structure. The new prompt should make clear: just call tree, get everything, no depth needed.

## Context loading — vault-structure is now a tree() call, not tree.md

- [ ] Update context.py to remove tree.md loading, replace with tree() call if needed

    The context loader in `core/agent/agent/context.py` currently loads three files: overview.md, tree.md, and profile.md. tree.md no longer exists as a pre-generated file. The initial context needs to either call the tree tool to get structure at startup, or the agent should be instructed to call tree() as its first action. The INITIAL_CONTEXT_PROMPT in `core/agent/prompts/context_prompt.py` references `<vault-structure>` as a pre-loaded section — this needs to reflect whatever the new approach is. The agent.md spec describes tree.md as auto-generated by a background job, but that mechanism is being removed.

## Agent behavior philosophy — generous context, fast decisions

- [ ] Write a dedicated prompt section on context window philosophy

    This is a standalone section that needs to exist in the agent prompts. Core message: this is knowledge work, not code generation. Large context windows (300k-400k tokens) improve quality rather than degrading it. The agent should load generously — 30k, 40k, 50k in one read is completely fine. The threshold where concern begins is around 150k tokens of active context. Below that, just load and go. No micro-optimization, no agonizing over whether to read a 10k file. The current AGENTIC_MODEL_PROMPT in `core/agent/prompts/agent_loop_prompt.py` has some of this but frames it too cautiously with "token awareness" guidance that encourages conservative behavior. The new version should encourage bold, fast context loading while being smart (not loading irrelevant content).

- [ ] Emphasize speed as a core agent value across all prompts

    Speed of execution matters deeply. The agent should load context quickly, make decisions quickly, act quickly. The current prompts have phrases like "think before you act" and "do not over-explore" but don't frame speed as a first-class concern. The agent loop prompt, the search strategy, and the update strategy all need to convey: be fast, be decisive, load what you need in big batches, don't do unnecessary intermediate steps.

## Vault structure description in prompts

- [ ] Add a concrete file tree representation of the vault structure in the environment prompt

    The environment prompt in `core/agent/prompts/env_prompt.py` describes the vault structure in prose. It should include an actual tree representation showing the folder hierarchy — similar to what vault.md has in the spec docs. The agent needs to internalize the repeatable project structure (description.md, state.md, tasks.md, changelog.md, bucket/) visually, not just through paragraph descriptions. This is especially important now that tree.md is no longer pre-loaded.

## Search tool prompt — more examples, more patterns

- [ ] Rewrite SEARCH_TOOL_PROMPT with concrete query and scope examples

    The current search prompt in `core/agent/tools/search_tool.py` has scope patterns but lacks concrete end-to-end examples of search strategies. It should show: "user asks X → here's the search call with queries and scopes that finds it." Deep search takes ~10 seconds, fast is instant — this timing info should be explicit so the agent can make speed tradeoffs. The prompt should demonstrate how to combine multiple queries in one call for broad coverage, how scope patterns target specific file types across all projects, and how search results often contain enough context to skip a follow-up read.

## Append tool prompt

- [ ] Review and tighten APPEND_TOOL_PROMPT for concision

    The append prompt in `core/agent/tools/append_tool.py` is decent but follows the old verbose style. Needs the same XML-first, concise treatment as everything else. Core message is simple: zero-read insertion, top for changelogs, bottom for tasks, duplicate H1 dates are fine.

## Write, edit, move, delete tool prompts

- [ ] Apply concision pass to all remaining tool prompts

    WRITE_TOOL_PROMPT, EDIT_TOOL_PROMPT, MOVE_TOOL_PROMPT, DELETE_TOOL_PROMPT all live in their respective files under `core/agent/tools/`. They all need the same treatment: strip verbose prose, use XML structure, keep only what the LLM needs to make correct tool choices. The current prompts explain "why" too much — the agent needs "when" and "how" with examples.

## Search agent and update agent system prompts

- [ ] Rebuild SEARCH_SYSTEM_PROMPT as tight XML assembly

    The search agent prompt in `core/agent/prompts/search_agent_prompt.py` assembles multiple sub-prompts into a large system prompt. The assembly structure (identity, environment, agent loop, context, tools, strategy, rules, output) is sound but each section is too wordy. The rebuilt version should be dense XML, with the search strategy section emphasizing speed, concrete patterns, and the generous context loading philosophy.

- [ ] Rebuild UPDATE_SYSTEM_PROMPT as tight XML assembly

    Same treatment for the update agent prompt in `core/agent/prompts/update_agent_prompt.py`. The update strategy section is the most critical — routing logic, file writing conventions, changelog logging. All need to stay but in compressed, example-driven form rather than explanatory prose.

## Concat tool prompt

- [ ] Simplify CONCAT_TOOL_PROMPT and clarify its role in the search agent output flow

    The concat prompt in `core/agent/tools/concat_tool.py` explains the two-part output mechanism (text overview + concat result). This is correct but could be much shorter. The key information: call it last, only include files you actually found, order by relevance. The explanation of how the system appends concat output is important but takes too many words currently.